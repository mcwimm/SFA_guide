<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.47">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Recommendations – SFA User Guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./recommendations.html">Recommendations</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SFA User Guide</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./launch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting started</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">SFA navigation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./settings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Settings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kvalue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><em>K</em> parameter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sapflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sap Flow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Uncertainty</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./general.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./trouble.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./recommendations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Recommendations</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setting-wood-and-sensor-properties" id="toc-setting-wood-and-sensor-properties" class="nav-link active" data-scroll-target="#setting-wood-and-sensor-properties">Setting wood and sensor properties</a>
  <ul class="collapse">
  <li><a href="#example-1-all-thermometers-are-in-the-stem" id="toc-example-1-all-thermometers-are-in-the-stem" class="nav-link" data-scroll-target="#example-1-all-thermometers-are-in-the-stem">Example 1: all thermometers are in the stem</a></li>
  <li><a href="#example-2-some-thermometers-are-outside-the-stem" id="toc-example-2-some-thermometers-are-outside-the-stem" class="nav-link" data-scroll-target="#example-2-some-thermometers-are-outside-the-stem">Example 2: some thermometers are outside the stem</a></li>
  </ul></li>
  <li><a href="#estimating-k" id="toc-estimating-k" class="nav-link" data-scroll-target="#estimating-k">Estimating <em>K</em></a>
  <ul class="collapse">
  <li><a href="#case-1-no-flow-records-exist" id="toc-case-1-no-flow-records-exist" class="nav-link" data-scroll-target="#case-1-no-flow-records-exist">Case 1: No-flow records exist</a>
  <ul class="collapse">
  <li><a href="#a-typical-k-diagram-pattern" id="toc-a-typical-k-diagram-pattern" class="nav-link" data-scroll-target="#a-typical-k-diagram-pattern">A) Typical K diagram pattern</a></li>
  <li><a href="#b-atypical-k-diagram-pattern" id="toc-b-atypical-k-diagram-pattern" class="nav-link" data-scroll-target="#b-atypical-k-diagram-pattern">B) Atypical K diagram pattern</a></li>
  </ul></li>
  <li><a href="#case-2-absence-of-no-flow-records" id="toc-case-2-absence-of-no-flow-records" class="nav-link" data-scroll-target="#case-2-absence-of-no-flow-records">Case 2: Absence of no-flow records</a>
  <ul class="collapse">
  <li><a href="#experiments" id="toc-experiments" class="nav-link" data-scroll-target="#experiments">Experiments</a></li>
  </ul></li>
  <li><a href="#case-3-instability-of-k" id="toc-case-3-instability-of-k" class="nav-link" data-scroll-target="#case-3-instability-of-k">Case 3: instability of K</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Recommendations</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="setting-wood-and-sensor-properties" class="level1">
<h1>Setting wood and sensor properties</h1>
<p>Wood and sensor properties can significantly affect the estimation of sap flow metrics and should be handled with care. The first step is to manually calculate the position of the first and last thermometer. After providing the values to the SFA, carefully compare your estimate with the estimates provided in the table in Settings &gt; Measurement Environment. Below are two examples of how this can be done.</p>
<section id="example-1-all-thermometers-are-in-the-stem" class="level2">
<h2 class="anchored" data-anchor-id="example-1-all-thermometers-are-in-the-stem">Example 1: all thermometers are in the stem</h2>
<p>Data set example: mangrove, thermometer position 1 The tree had a diameter of 25.2 cm, the bark was removed, and the sensor was placed with 11 mm distance from the stem. The sensor had 20 mm distance between needle head and the first thermometer and 10 mm distance between each of the 8 thermometers. The first (i.e., outermost) and last (i.e., innermost) thermometers are 11.7 cm and 4.7 cm from the center of the stem, respectively. The figure describes how these measurements are derived.</p>
<p><img src="assets/images/recommendations_settings_1.png" class="img-fluid" width="600"></p>
<p>This information requires the following inputs in the SFA:</p>
<p><img src="assets/images/recommendations_settings_2.png" class="img-fluid" width="500"></p>
<p>The Sensor Type drop-down menu allows you to enter specific sensor configurations, such as different distances between thermometers. If the inputs are correct, the distances for the outermost and innermost thermometers in the table at the bottom of the Measurement Environment box should match the previously calculated values.</p>
<p><img src="assets/images/recommendations_settings_3.png" class="img-fluid" width="500"></p>
</section>
<section id="example-2-some-thermometers-are-outside-the-stem" class="level2">
<h2 class="anchored" data-anchor-id="example-2-some-thermometers-are-outside-the-stem">Example 2: some thermometers are outside the stem</h2>
<p>Assuming the wood and sensor properties from above but a spacer length of 25 mm leads to a specific case, where the first (outermost) thermometer is located outside the stem. The distance between the center of the stem and this thermometer is 13.1 cm, which is larger the stem radius of 12.6 cm. The first thermometer inside the stem has a distance of 12.1 cm to the center and the last (innermost) of 6.1 cm.</p>
<p><img src="assets/images/recommendations_settings_4.png" class="img-fluid" width="600"></p>
<p>If all entries are made correctly the table in the SFA looks like this:</p>
<p><img src="assets/images/recommendations_settings_5.png" class="img-fluid" width="500"></p>
<p>Because a thermometer is outside the stem, a warning appears below the table. In this case, the thermometer should be removed from the data set. This can be done in Data &gt; Filter &gt; Filter Options by specifying which thermometers should be used for further analysis.</p>
<p><img src="assets/images/recommendations_settings_6.png" class="img-fluid" width="300"></p>
<p>Note that this is a rare case. In the case of small stems with radii less than the needle length, the sensors can be fully inserted to obtain even two radial profiles (i.e., from the opposite side of the installation).</p>
</section>
</section>
<section id="estimating-k" class="level1">
<h1>Estimating <em>K</em></h1>
<section id="case-1-no-flow-records-exist" class="level2">
<h2 class="anchored" data-anchor-id="case-1-no-flow-records-exist">Case 1: No-flow records exist</h2>
<section id="a-typical-k-diagram-pattern" class="level3">
<h3 class="anchored" data-anchor-id="a-typical-k-diagram-pattern">A) Typical K diagram pattern</h3>
<ul>
<li>In this example data set, the K diagram shows a clear pattern as described, for example, in Nadezhdina 2018, including no-flow records. That is, the temperature differences (dTas, dTsa and dTSym) cross the y-axis.</li>
<li>Here, <em>K</em> estimation method “no-flow median” can be used.</li>
<li>The left figure below shows the typical pattern observed in K diagrams. The red star in the left figure indicates the <em>K</em> value.</li>
<li>Control plot 1 (right figure) confirms the fitness of the estimate, as the green (dTSym) and yellow (<em>K</em>+dTsa) data points intersect at the origin.</li>
</ul>
<p><img src="assets/images/recommendations_k_1.png" class="img-fluid" width="600"></p>
</section>
<section id="b-atypical-k-diagram-pattern" class="level3">
<h3 class="anchored" data-anchor-id="b-atypical-k-diagram-pattern">B) Atypical K diagram pattern</h3>
<ul>
<li>In this example data set, the <em>K</em> diagram does not show a distinct pattern and the intersection of the data points with the y-axis is not clear.</li>
<li>In this case, many data points exist around the y-axis (for dTsym/dTas close to 0).</li>
<li>Using the no-flow median method can lead to over- or underestimation of <em>K</em>. This method takes the value closest to the y-axis and, if there are multiple values, calculates the median.</li>
<li>The figure below shows that the no-flow median method underestimates <em>K</em> for this data set. This is illustrated by the <em>K</em> control plot 1, where the yellow point cloud does not pass through the origin as it should.</li>
</ul>
<p><img src="assets/images/recommendations_k_2.png" class="img-fluid" width="600"></p>
<ul>
<li>In such cases, it is advised to check the no-flow regression method.</li>
<li>In the figure below, the no-flow regression is applied with the time filter set to 10 pm to 6 am.</li>
<li>The control plot 1 confirms that the estimate of <em>K</em> = 1.12 is better than <em>K</em> = 1.05 obtained with no-flow median.</li>
</ul>
<p><img src="assets/images/recommendations_k_3.png" class="img-fluid" width="600"></p>
<ul>
<li>Estimation of K can be aided by zooming the K plot and control plots. This is done by selecting a fixed scale and entering the range of data to be displayed on the x-axis.</li>
</ul>
<p><img src="assets/images/recommendations_k_4.png" class="img-fluid" width="400"></p>
</section>
</section>
<section id="case-2-absence-of-no-flow-records" class="level2">
<h2 class="anchored" data-anchor-id="case-2-absence-of-no-flow-records">Case 2: Absence of no-flow records</h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>It is recommended that conditions leading to no-flow records be artificially created in the field (see <code>Experiments</code> for details). If this is not possible, K must be approximated, but all estimates must be treated with caution. This is only recommended for users with experience in HFD data analysis.</p>
</div>
</div>
</div>
<ul>
<li>In this example, the dataset contains no-flow records that occurred during 1 day in a 5-days measuring period (foggy and drizzling day)</li>
<li>To demonstrate the difficulty of estimating K in the absence of no-flow records, the data set was split into one set that included the wet day and one set that did not and therefore had no no-flow records (“dry conditions”).</li>
</ul>
<p><img src="assets/images/recommendations_k_5.png" class="img-fluid" width="500"></p>
<ul>
<li>In the case of absent no-flow records, it is recommended to use no-flow regression including filter options to optimize the regression.</li>
<li>Without any filter adjustments, the regression results in an estimate of <em>K</em>=1.77.</li>
<li>Without data points near the y-axis, control plots also become difficult to use. However, for regression, it is recommended to use the downward portion of the dTas point cloud. In this case, a steeper regression line for dTas is expected to result in a better estimate of <em>K</em>.</li>
</ul>
<p><img src="assets/images/recommendations_k_6.png" class="img-fluid" width="500"></p>
<ul>
<li>To optimize the regression, select values with as close to no-flow conditions as possible. The “diurnal flow” diagram helps to identify the time period with the lowest flow. In this example, sap flow is lowest between midnight and 10 am. Applying this to the filter, reduces K to 1.69.</li>
</ul>
<p><img src="assets/images/recommendations_k_7.png" class="img-fluid" width="400"></p>
<ul>
<li>The selection of data points used for the regression can be further refined by defining a maximum value for the ratio dTsym:dTas</li>
<li>The left diagram below shows the regression with the time filter, while the right diagram shows the regression when a maximum value for the ratio dTsym:dTas (i.e., 0.35) is defined. Both yield to similar <em>K</em> values, i.e., 1.69 and 1.71, respectively.</li>
</ul>
<p><img src="assets/images/recommendations_k_8.png" class="img-fluid" width="400"></p>
<ul>
<li>Decreasing the maximum ratio dTsym:dTas would further decrease K in this example. When the threshold is set to 0.25, K is 1.61 but with a low coefficient of determination as only few data points are left for the regression.</li>
<li>The following figure shows the estimates for <em>K</em> when applying different thresholds for dTsym:dTas.</li>
</ul>
<p><img src="assets/images/recommendations_k_9.png" class="img-fluid" width="400"> - Using the complete data set, i.e., including the no-flow records obtained with the irrigation experiment, shows that <em>K</em> is ~1.61. This value could only be reached by setting the maximum ratio dTSym:dTas as low as possible.</p>
<p><img src="assets/images/recommendations_k_10.png" class="img-fluid" width="400"></p>
<ul>
<li>Applying this strategy to all thermometer positions, results in the following estimates of <em>K</em>. For 3 thermometers, <em>K</em> is overestimated in the absence of no-flow records.</li>
</ul>
<p><img src="assets/images/recommendations_k_11.png" class="img-fluid" width="400"></p>
<ul>
<li>The higher estimate for <em>K</em> result in an overestimation of daily TWU between 7.7 and 8.7 %.</li>
</ul>
<p><img src="assets/images/recommendations_k_12.png" class="img-fluid" width="400"></p>
<ul>
<li>As the flow rate in the second thermometer position is relatively high, the uncertainty of this <em>K</em> estimate has a high impact.</li>
</ul>
<p><img src="assets/images/recommendations_k_13.png" class="img-fluid" width="400"></p>
<section id="experiments" class="level3">
<h3 class="anchored" data-anchor-id="experiments">Experiments</h3>
<p>In the absence of no-flow records and if it is not possible to wait until such conditions occur (e.g., rain, fog or dew), it is advised to trigger no-flow or reverse flow conditions with experiments (Nadezhdina, 2018, p.125). Such experiments are: - artificial fog by crown microsprinkling - localized irrigation at the opposite side of sensor installation - cuttings bellow (for aboveground organs) or above (for roots) the measuring point to create zero driving force. The latter suits for short-term experiments and can be done at their end.</p>
</section>
</section>
<section id="case-3-instability-of-k" class="level2">
<h2 class="anchored" data-anchor-id="case-3-instability-of-k">Case 3: instability of K</h2>
<p>See Nadezhdina (2018, page 125f.) for detailed examples - <em>K</em> is usually stable over long periods of time. - However, if it changes, there may be several reasons + External influences: insufficient isolation of sensor and measuring point, power fluctuations, … + Internal influences: tissue drying, … - External influences should be avoided at the outset. However, observing the instability of <em>K</em> can help to identify the occurrence of such conditions. - Internal influences to not depend on the measuring setup. In such cases, several <em>K</em> values must be estimated for the same thermometer position. This is not directly integrated in the SFA, but can be achieved by using the visualization and filter options (‘Data’ menu) in the SFA. - For example, the change of dTas over time can be visualized with the following settings</p>
<p><img src="assets/images/recommendations_k_14.png" class="img-fluid" width="400"></p>
<ul>
<li>Or, alternatively, as in the following figure. Such a visualization can help to identify shifts in nighttime maxima.</li>
</ul>
<p><img src="assets/images/recommendations_k_15.png" class="img-fluid" width="400"></p>
<ul>
<li>If sudden shifts are detected, the data set can be divided using the ‘Filter’ section.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/mcwimm\.github\.io\/SFA_guide\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>